{% extends "template.njk" %}

{% from "back-link/macro.njk" import govukBackLink %}
{% from "footer/macro.njk" import govukFooter -%}
{% from "phase-banner/macro.njk" import govukPhaseBanner %}
{% from "skip-link/macro.njk" import govukSkipLink -%}
{% from "./partials/change-requests-banner.html" import changeRequestsBanner %}
{% from "./partials/preview-banner.html" import previewBanner %}
{% from "./partials/mhclg-header.html" import mhclgHeader %}

{% block head %}
    <!--[if !IE 8]><!-->
    <link rel="preload" as="font" href="{{ assetPath }}/fonts/bold-b542beb274-v2.woff2" type="font/woff2"
          crossorigin="anonymous">
    <link rel="preload" as="font" href="{{ assetPath }}/fonts/bold-b542beb274-v2.woff2" type="font/woff2"
          crossorigin="anonymous">
    <link rel="preload" as="font" href="{{ assetPath }}/fonts/bold-affa96571d-v2.woff" type="font/woff"
          crossorigin="anonymous">
    <link rel="preload" as="font" href="{{ assetPath }}/fonts/light-f591b13f7d-v2.woff" type="font/woff"
          crossorigin="anonymous">
    <link href="{{ assetPath }}/stylesheets/application.css" rel="stylesheet"/>

    <!--<![endif]-->

    {# For Internet Explorer 8, you need to compile specific stylesheet #}
    {# see https://github.com/alphagov/govuk-frontend/blob/master/docs/installation/supporting-internet-explorer-8.md #}
    <!--[if IE 8]>
    <link href="/govuk-frontend/all-ie8.css" rel="stylesheet"/>
    <![endif]-->

    {# For older browsers to allow them to recognise HTML5 elements such as `<header>` #}
    <!--[if lt IE 9]>
    <script src="/html5-shiv/html5shiv.js"></script>
    <![endif]-->

    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments)
        }

        if (localStorage.getItem('consentMode') === null) {
            gtag('consent', 'default', {
                'ad_storage': 'denied',
                'analytics_storage': 'denied',
                'personalisation_storage': 'denied',
                'functionality_storage': 'denied',
                'security_storage': 'denied',
            });
        } else {
            gtag('consent', 'default', JSON.parse(localStorage.getItem('consentMode')));
        }
    </script>
    <!-- Google Tag Manager -->
    <script>(function (w, d, s, l, i) {
            w[l] = w[l] || [];
            w[l].push({
                'gtm.start':
                    new Date().getTime(), event: 'gtm.js'
            });
            var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : '';
            j.async = true;
            j.src =
                'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
            f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-M5J9Q8HV');
    </script>
    <!-- End Google Tag Manager -->

    <!-- Matomo -->
    {% if matomoUrl and matomoId %}
        <script type="text/javascript">
            var _paq = window._paq || [];
            _paq.push(['disableCookies']);
            _paq.push(['trackPageView']);
            _paq.push(['enableLinkTracking']);
            (function () {
                var u = "{{ matomoUrl }}/piwik/";
                _paq.push(['setTrackerUrl', u + 'piwik.php']);
                _paq.push(['setSiteId', '{{ matomoId }}']);
                var d = document, g = d.createElement('script'), s = d.getElementsByTagName('script')[0];
                g.type = 'text/javascript';
                g.async = true;
                g.defer = true;
                g.src = u + 'piwik.js';
                s.parentNode.insertBefore(g, s);
            })();
        </script>
        <noscript><p><img src="{{ matomoUrl }}/piwik/piwik.php?idsite={{ matomoId }}&amp;rec=1" style="border:0;"
                          alt=""/></p></noscript>
    {% endif %}
    <!-- End Matomo Code -->

    <script src="{{ assetPath }}/accessible-autocomplete.min.js"></script>
    <script src="{{ assetPath }}/tinymce.min.js"></script>
{% endblock %}

{% block pageTitle %}
    {{ pageTitle }}
{% endblock %}

{% block skipLink %}
    {{ govukSkipLink({
        href: '#main-content',
        text: 'Skip to main content'
    }) }}
{% endblock %}

{% block header %}
    {{
        mhclgHeader(
            params={
                "serviceName": name if name else serviceName,
                "homepageUrl": "#"
            }
        )
    }}
{% endblock %}

{% block bodyStart %}
    <!-- Google Tag Manager (noscript) -->
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M5J9Q8HV"
                height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
    <!-- End Google Tag Manager (noscript) -->
{% endblock %}

{% block beforeContent %}
    {% if phaseTag %}
        {% if feedbackLink %}
            {{ govukPhaseBanner({
                tag: {
                    text: i18nGetTranslation("head.banner.tag")
                },
                html: i18nGetTranslation("head.banner.title")
            }) }}
        {% else %}
            {{ govukPhaseBanner({
                tag: {
                    text: i18nGetTranslation("head.banner.tag")
                }
            }) }}
        {% endif %}
    {% endif %}

    {% if page.backLink or backLink %}
        {% if page.backLink %}
            {{ govukBackLink({
                href: page.backLink,
                text: page.backLinkText
            }) }}
        {% else %}
            {{ govukBackLink({
                href: backLink,
                text: backLinkText
            }) }}
        {% endif %}
    {% endif %}

    {% if changeRequests.length > 0 %}
        {{ changeRequestsBanner(changeRequests) }}
    {% endif %}
    {% if not isStartPage and changeRequests.length == 0 and isResubmission %}
        <div class="govuk-!-margin-top-4">
            <p id="form-page-title-tag" class="govuk-!-margin-0">
                <span class="govuk-tag govuk-tag--green">No change needed</span>
            </p>
        </div>
    {% endif %}

    {% if previewMode %}
        {{ previewBanner() }}
    {% endif %}

{% endblock %}


{% block content %}
    <h1 class="govuk-heading-l">Default page template</h1>
{% endblock %}


{% block bodyEnd %}
    {% include "partials/modal-dialog.html" %}
    <script src="{{ assetPath }}/jquery-3.5.1.min.js"></script>
    <script src="{{ assetPath }}/object-from-entries-polyfill.js"></script>
    <script type="module" src="{{ assetPath }}/all.bundle.js"></script>
    <script src="{{ assetPath }}/govuk-template.js"></script>
    <script src="{{ assetPath }}/dialog-polyfill.0.4.3.js"></script>
    <script src="{{ assetPath }}/modal-dialog.js"></script>
    <script src="{{ assetPath }}/upload-dialog.js"></script>

    <script>
        $(document).ready(function () {
            GOVUKFrontend.initAll()

            {% if not skipTimeoutWarning %}
            GOVUKFrontend.modalDialog.containerSelector = '#main-content'
            GOVUKFrontend.modalDialog.idleMinutesBeforeTimeOut = Number('{{ (sessionTimeout / 60000) - 1 }}')
                - GOVUKFrontend.modalDialog.minutesTimeOutModalVisible
            GOVUKFrontend.modalDialog.init()
            {% endif %}
        });
    </script>

    {% if BROWSER_REFRESH_URL %}
        <script src="{{ BROWSER_REFRESH_URL }}"></script>
    {% endif %}
{% endblock %}


{% block footer %}
    {% set footerItems = [] %}
    {% if footer %}
        {% for footerItem in footer %}
            {% set _ = footerItems.push({
                href: footerItem.href,
                text: footerItem.text
            }) %}
        {% endfor %}
    {% else %}
        {% set footerItems = [{
            href: privacyPolicyUrl,
            text: i18nGetTranslation("footer.privacy")
        }, {
            href: cookiePolicyUrl,
            text: i18nGetTranslation("footer.cookies")
        }, {
            href: accessibilityStatementUrl,
            text: i18nGetTranslation("footer.accessibilityStatement")
        }, {
            href: contactUsUrl,
            text: i18nGetTranslation("footer.contactUs")
        }] %}
    {% endif %}
    {{ govukFooter({
        meta: {
            items: footerItems
        }
    }) }}
{% endblock %}
